### Download Engine Functions Library ###

. /opt/etc/dlengine.conf

PATH=/opt/bin:/opt/sbin:/opt/local/bin:/sbin:/bin:/usr/bin:/usr/sbin
PLUGINS_DIR=/opt/var/lib/dlengine/plugins/
MAINPID="/var/run/dlengine.pid"
TASKPID="/var/run/dletask.pid"
DAEMON="/opt/bin/dlengine"
export PATH

RC_OK=0
RC_FAIL=1
RC_WAIT=2

log()
{
echo $1 >>$LOGFILE
}

get_login_password()
{
auth=""
login=""
password=""
for ((i=0; i<${#AUTHEXP[*]}; i++)); do
   if [ -n "`echo $1 | grep -i -e ${AUTHEXP[$i]}`" ]; then
      auth="--user=${AUTHUSR[$i]} --password=${AUTHPAS[$i]}"
      login="${AUTHUSR[$i]}"
      password="${AUTHPAS[$i]}"
      return 0
   fi
done
return 1
}

daemonrunning()
{
if [ -e $MAINPID ] && [ -n "`pidof dlengine | grep -w -f $MAINPID`" ]; then
   return 0
fi
return 1
}

readqueue()
{
unset queue
i=0
while read line; do
   queue[$i]="$line"
   i=$i+1
done <$QUEUEFILE
if [ -n "$line" ]; then
   queue[$i]="$line"
fi
}

savequeue()
{
for ((i=0; i<${#queue[*]}; i++)); do
   echo ${queue[$i]}
done >$QUEUEFILE
}

deleteurl()
{
for ((i=$1; i<${#queue[*]}-1; i++)); do
   queue[$i]=${queue[$i+1]}
done
unset queue[${#queue[*]}-1]
}

deleteurlbyname()
{
cat "$QUEUEFILE" | grep -v "$1" >$TEMPDIR"queue.tmp"
mv $TEMPDIR"queue.tmp" "$QUEUEFILE"
}

swapurls()
{
temp=${queue[$1]}
queue[$1]=${queue[$2]}
queue[$2]=$temp
}
